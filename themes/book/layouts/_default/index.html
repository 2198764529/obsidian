{{ define "main" }}
<main aria-role="main">
    <div id='calendar'></div>


    <div id="app">
      <el-calendar v-model="today">
  
        <template
        slot="dateCell"
        slot-scope="{date, data}"
        
        >
        ${data.day.split('-')[2]}} 
          <div  
          class="calendarTask"
          v-if="jsonData[data.day]" 
          v-for="item in jsonData[data.day]"
           @click="sendCustomNotification(data.day,jsonData[data.day],'info')">
           <i class="el-icon-delete"></i>
  
             <el-tag type="success">${item.task}} </el-tag>
  
          </div>
       
    
      </template>
      </el-calendar>
    </div>
  <!-- 引入 fullCalendar.js -->
  <script src="js/fullCalendar.js" ></script>
  <script>
    var content = "{{ $page := .Site.GetPage `/posts/日志.md` }}{{ $page.RawContent }}";
    calendarRender(content);
  </script>
 


  <h4>
     <span class="nowDate" data-unix="{{ now.Unix }}">  </span>
  </h4>

  <h4>
    {{ $totalWordCount := 0 }}

    {{ range .Site.RegularPages }}
      {{ with .Content }}
        {{ $wordCount := printf "%s" . | len }}
        {{ $totalWordCount = add $totalWordCount $wordCount }}
      {{ end }}
    {{ end }}
    博客共 {{ .Site.RegularPages | len }} 个文章, 共计 <span>{{ $totalWordCount }}</span> 字
  </h4>
  <h4>

    {{ if .Site.LastChange.After .GitInfo.AuthorDate }}
    <!-- 如果站点的最后更改时间晚于作者的最后提交日期，显示提醒消息 -->
    上次提交在
    <span class="AuthorDate" data-unix="{{ .GitInfo.AuthorDate.Unix }}"> </span>
    , 请勿忘记提交
    {{ end }}



  </h4>
 
  {{ $csvPath := "content/data/myData.csv" }}
  {{ $csvContent := getCSV "," "content/data/" "myData.csv"}}
  {{ $csvKeys := index $csvContent 0}}
  {{$pages :=.Site.RegularPages.GroupByLastmod "2006-01-02"}}
  {{ $pagesDict := dict }}
  {{ range $pages }}
    {{ $pagesDict = $pagesDict | merge (dict .Key .) }}
  {{ end }}
  {{ $data := slice }}
  {{ range $i,$v :=$csvContent }}
    {{$IS_NONE :=delimit $v ","  | strings.Count ",,,,,,"}}
    {{$IS_FISRT := eq $i 0}}
    {{ if or $IS_NONE $IS_FISRT}}
        
        {{ continue }}
    {{ end }}


    {{ $date := replace (index $v 0) "/" "-"}}
    {{$sub_data := dict}}
    {{range $i2,$v2 :=$v}}
        {{if ne ($v2 | strings.Count "") 1}}
          {{$type := index $csvKeys $i2}}
          {{if lt $i2 6}}
              {{$text:=$v2}}
              
             

              {{$sub_data = merge $sub_data (dict "count" (dict $type $text))}}

          {{else if eq $i2 6}}
              {{$sub_data = merge $sub_data (dict $type (split $v2 ";;;"))}}
        
          {{end}}

          
        {{end}}

    {{end}}

  
    {{with index $pagesDict $date}}
        {{$ls := slice}}
        {{range (index $pagesDict $date).Pages}}
            {{$ls = $ls |append (dict "type" "md"  "date" .Lastmod.Unix "title" .Title)}}

        {{end}}
        {{$sub_data = merge $sub_data (dict "md" $ls)}}
    {{end}}

    {{ $data =  $data | append slice ($sub_data) }}
  {{end}}
  {{ $data = $data | uniq  }}
  {{$data = last (sub (len $data) 1) $data}}
 
  {{ partial "docs/timeline" (dict "messageData" $data) }}


  <script>
    // 在页面加载时执行的 JavaScript 代码
    window.onload = function () {
      // 更新具有 "LastChange" 类名的元素的时间戳
      updateDateTimeByElementClass("LastChange");
      // 更新具有 "AuthorDate" 类名的元素的时间戳
      updateDateTimeByElementClass("AuthorDate");
      // 更新具有 "nowDate" 类名的元素的时间戳
      updateDateTimeByElementClass("nowDate");
      // 更新具有 "date" 类名的元素的时间戳
      updateDateTimeByElementClass("date");
    }; 
  </script>
</main>
{{ end }}
