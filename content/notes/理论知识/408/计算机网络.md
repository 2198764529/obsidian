---
mermaid: true
plantuml: true
title: 计算机网络
id: f4cc04863a
datetimeCreate: 2023-10-24 17:01:08
datetimeUpdate: 2024-09-05 11:14:00
---
## 概览
计网的层次体系可以用两个体系来解释， 分别是理论上七层的 OSI 体系 和 实际采用的 四层 TCP/IP 体系，后者是对前者的继承和简化， 现实中基本上都是 TCP/IP 四层，但是要理解计网的内容则还要结合两者进行学习。

下面是有关 TCP/IP 体系和 OSI 体系的 数据单元、主要设备、相关协议的一览表。

| TCP/IP 体系 | OSI 体系 | 数据单元 | 主要设备 | 相关协议 | 
| --- | --- | --- | --- | --- |
| ^应用层 | 应用层 | ^数据(Data) | 服务器 | SMTP、HTTP、HTTP、Telent、SSH、DNS、FTP|
|  | 表示层 |  | ^无专门设备 |  |
|  | 会话层 | 消息(Messages) |  |  |
| 运输层 | 运输层 | 数据报(Datagrams) |  | TCP、UDP |
| 网络层 | 网络层 | 数据包(Packets) | 路由器、三层交换机 | ARP、RARP、ICMP、IP、IMGP |
| ^数据链路层 | 数据链路层 | 帧(Frames) | 交换机、网桥、网卡 | PPP、CRC |
|  | 物理层 | 比特流 | 网卡、集线器、网络电缆、中继器 | IEEE802.1A IEEE802.2到IEEE802.11 |

### 应用层
应用层负责为应用软件提供网络服务的接口

```mindmap 
应用层
	FTP——文件传输协议【21】
	SSH——加密远程登录协议【22】
	Telent——远程登录协议【23】
	SMTP——简单邮件传输协议【25】
	DNS——域名系统【UDP、TCP】【53】
	HTTP——超文本传输协议【80】
	POP3——邮件接收协议【98】
	IMAP——邮件同步协议【143】
	DHCP——动态IP协议【UDP】【67客户端请求、68服务器响应】
	HTTPS——SSL/TLS加密的HTTP协议【443】
```
### 表示层
表示层负责为应用层提供数据转换操作，包括数据解密、数据压缩、数据格式转换。

### 会话层
会话层负责管理会话进程，包括建立、管理、终止会话进程。

### 运输层
运输层负责提供端到端传输、差错控制和流量控制，其中，端到端的传输包括 TCP 协议、UDP协议。
下表为 TCP 协议、UDP 协议之间的不同之处。
|  | TCP 协议 | UDP 协议 |
| --- | --- | --- |
| 首部长度 | 20 Byte | 8 Byte |
| 可靠 | ^是 | ^否 |
| 有序 |  |  |
| 建立连接 |  |  |
| 流量控制 |  |  |
| 拥塞控制 |  |  |
| 传输对象 | 字节流 | 数据包 |
| 通信限制 | 1对1 | 都支持 |

##### 三次握手
三次握手的主要作用是测试双方的发送和接收能力都正常, 因为 TCP 是全双工通信, 所以要保证双方的发送和接收能力都是正常的。


![11](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/10/8/16da9fd28a45bd19~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png)

第一请求是客户端发，服务端收， SYN=1 、seq=x。
第二请求是服务端发，客户端收， SYN=1，ACK=1，ack=x+1，seq=y。
第三请求是客户端发，服务端收， ACK=1，ack=y+1，seq=x+1。

服务端收到请求一并发送请求二时, 证明了客户端能发和服务端能收。客户端收到请求二发送请求三时, 证明了服务端能发和客户端能收，至此可以建立全双工的 TCP 连接了。


##### 四次挥手
同样的, 四次挥手是测试双方的发送和接收都已关闭。

![11](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/10/8/16da9fd28b49f652~tplv-t2oaga2asx-jj-mark:3024:0:0:0:q75.png)

请求一是客户端发，服务端收， FIN=1 、seq=x。
请求二是服务端发，客户端收， ACK=1，ack=x+1、seq=y。
请求三是服务端发，服务端收， FIN=1，ACK=1、ack=x+1、seq=z。
请求四是客户端发，服务端收， ACK=1 、ack=z+1、seq=x+1。

同样的， 客户端发送完请求一并收到请求二时， 客户端的发和服务端的收已经关闭。
不服务端发送完请求三并收到请求四，服务端才关闭客户端的收和服务端的发。
特别之处在于，为了防止请求四丢失，要等待一个报文存在最大时长（2MSL）才彻底断开连接，如果


### 网络层
网络层负责实现数据的透明传输、路径选择、逻辑寻址。
```mindmap
网络层
	IP 协议部分
		IP 地址
		子网划分
	IP 传播部分
		ARP——地址解析协议
		RARP——逆地址解析协议
		ICMP——网络控制报文协议
	路由算法部分
		IGP（内部网关协议，系统内部）
			RIP——跳数优先协议
			OSPF——长度优先协议
		EGP（外部网关协议，系统之间）
			BGP——路由交换协议
```

```mindmap 

_设计思路
	简单灵活的,无连接的,尽最大努力交付的数据报服务
IP\nInternet Protocol\n网际协议
	[#FFBBCC] 配套协议
		ARP\nAddress Resolution Protocol\n地址解析协议(IP->MAC)
		ICMP\nInternet Control Message Protocol\n控制报文协议
		IGMP\nInternet Group Management Protocol\n网际租管理协议
	[#FFBBCC] IP 地址编址
		历史发展阶段, 分类的IP地址>>子网的划分>>构成超网
		构成
			{<网络号>,<主机号>}
		分类
			A 类,{ <网络号(开头为0),8位>,<主机号,24位>}
			B 类,{ <网络号(开头为10),16位>,<主机号,16位>}
			C 类,{ <网络号(开头为110),24位>,<主机号,8位>}
			D 类,开头为1110,多播地址
			E 类,保留为今后使用
	ARP\nAddress Resolution Protocol\n地址解析协议
		功能:用IP地址找到局域网内的对应硬件地址
		关键词:ARP cache, 广播, 局域网
		过程:广播问局域网内主机对应IP的MAC地址,\n匹配主机单播回应
```

### 数据链路层
数据链路层负责解决封装成帧、透明传输、差错检测。
```mindmap
数据链路层
	点对点信道——PPP协议
	广播信道
		局域网协议
			LLC，逻辑链路控制
			MAC，媒体接入子层
		接入方式
			CSMA/CD， 载波监听多点接入/碰撞检测
```

### 物理层
```mindmap
物理层
	特性——机械、电气、功能、过程
	调制
		基带调制（编码）
			不归零、归零
			曼彻斯特、差分曼彻斯特
		载波调制
			调幅、调相、调位
	信道
		类型：单工、半双工、全双工
		极限容量因素：信道频率范围、信噪比
		传输媒体：双绞线、同轴电缆、光纤
		复用技术：FDM、TDM、STDM（统计时分）、CDM、WDM
		宽带接入技术：ADSL（拨号上网）、FTTH（光纤到户）
```




# 应用层
应用层协议是为了各应用进程需要不同的通信规则而存在的, 也是要依赖运输层所提供的基本通信服务。
##### 概念
应用层主要包括以下内容
- 域名系统 DNS
- WWW 和 HTTP 协议
- 电子邮件的相关协议，SMTP 协议和 POP3 协议、IMAP 协议

##### 域名系统 DNS
DNS 的作用是将域名转为IP地址，具体的过程是应用进程调用 resolver（解析程序），发送包含待解析的域名的 DNS 请求报文，通过 UDP 进行再包装发送到本地域名服务器，本地域名服务器搜索以后，把对应的 IP 地址放在回答报文返回。

##### 域名
域名是一个空间概念，可比作一个盒子，最大的一个盒就是顶级域名，再里面的盒子叫做二级域名，再里面的盒子叫做三级域名。
如www.baidu.com这个域名，从左到右域名等级依次提高，com就是顶级域名，baidu则是二级域名，www是三级域名。

这些顶级域名和二级域名以及其他等级的域名都是要遵守域名规则
- 必须是英文字母或数字，不区分大小写
- 一个域名长度不超过 63 个字符
- 所有域名加起来长度 255 个字符
# 运输层
### TCP 协议
特点:面向连接(虚连接);点对点;可靠有序,不丢不重;全双工通信;字节流
全双工通信:发送缓存和接收缓存

##### TCP首部
```
0                8                16                24                   31
---------------------------------------------------------------------------
                 源端口            |               目的端口
---------------------------------------------------------------------------
                                  序号(seq)
---------------------------------------------------------------------------
                                  确认号
---------------------------------------------------------------------------
首部长度|保留|[URG,ACK,PSH,RST,SYN,FIN] |		  接收窗口大小
---------------------------------------------------------------------------
              检验和                 |                 紧急指针
---------------------------------------------------------------------------
              选项(长度可变)                         |       填充
---------------------------------------------------------------------------
                              图 TCP的报文段首部


```

说明:
1. TCP首部总长为21B(20B固定,1B占位),第一行总长度都是4B(32位), `|`表示所占区分割线,如源端口所占为[0,16]的区域
2. 序号(seq):在TCP连接的字节流中,报文段中第一个字节的序号
确认号: 下一个要收报文段的序号, 序号为N, 则序号到N-1的数据都已收到
首部长度:表示TCP首部的长度,单位为4B
URG:紧急位,调整报文段优先级
ACK: TCP连接之后,ACk=1,标识为有效报文
PSH: 不需要等发送缓存填满才发
SYN: 标识为同步报文
FIN: 标识为终止报文
接收窗口大小:能够接收窗口的大小
检验和:检验首部+数据,检验要加12B伪首部,第四个字段为6
紧急指针: URG=1才有意义,紧急数据的字节数
选项: 最大报文长度MSS, 窗口扩大,时间戳

### UDP
UPD 头部信息包括4个内容, 分别是从哪来（源端口）、到哪去（终端口）、有多长（长度）、对不对（校验和）


### 应用层协议的支持
TCP: SMTP, FTP, HTTP, TELENT
UDP: 其他

### 网络层

##### IP 地址的分类

五类IP地址
A类,开头为0，0.0.0.0 ~ 127.255.255.255, 私有地址为10.0.0.0/8 
B类,开头为10，128.0.0.0 ~ 191.255.255.255,私有地址为172.16.0.0/12
C类,开头为110，192.0.0.0 ~ 223.255.255.255,私有地址为192.168.0.0/16
D类,开头为1110，224.0.0.0 ~ 239.255.255.255
E类,开头为1111，240.0.0.0 ~ 255.255.255.255

##### 子网掩码

内网中192.168.1.199的前三组是网络号，后一组是主机号，子网掩码就是255.255.255.0 
首先要说明的是：不是某个IP的网络号和主机号决定子网掩码是什么，而是子网掩码决定了某个IP地址的网络号与主机号是什么，IP地址是要搭配子网掩码使用的。例如上面的子网掩码决定了192.168.1.199的前三段192.168.1是网络号，最后一段199是主机号。
我们再来理解子网掩码的作用，先举个例子，市面上的两个厂家都生产电子秤，每个厂家都坚称他们的秤最准，那你是怎么知道他们的秤到底准不准？很简单，你去找一个 1KG 的国际千克原器，各放到他们的秤上测量，如果秤的测量值是1KG，那这把秤就是准的，子网掩码的作用就相当于这个大家公认的国际千克原器，是我们测量两个IP是否属于同一个网段的一个工具（应该说是让你知道某个IP地址的网络号与主机号分别是什么） 。

如果让你判断一个IP地址：192.168.1.199的网络号和主机号分别是什么？
请问你怎么判断？你凭什么说192.168.1是网络号？199是主机号？有什么根据吗？
但是如果我给你一个IP地址是以下（带子网掩码）形式的：
IP：192.168.1.199 
子网掩码：255.255.255.0 
那么根据大家公认的规则，你就可以得出这个IP的网络号和主机号了，怎么算呢？
子网掩码的长度和IP地址一样也是一串32位的二进制数字，只不过为人类的可读性和记忆性的方便，通常使用十进制数字来表示，例如把上面的IP地址和子网掩码都转换成相应的二进制就是下面这样的：十进制 二进制
IP 地址：192.168.1.199 ‐＞11000000.10101000.00000001.11000111
子网掩码：255.255.255.0 ‐＞11111111.11111111.11111111.00000000
十进制的显示形式是给人看的，二进制的显示形式是给计算机看的。。。
子网掩码的左边是网络位，用二进制数字“1”表示，1的数目等于网络位的长度；右边是主机位，用二进制数字“0”表示，0的数目等于主机位的长度。 
例如上面的子网掩码255.255.255.0的 “1”的个数是左边24位，则对应IP地址左边的位数也是24位;
十进制 二进制
IP 地址：192.168.1.199 ‐＞11000000.10101000.00000001.11000111
子网掩码：255.255.255.0 ‐＞11111111.11111111.11111111.00000000
则这个IP地址的网络号就是11000000.10101000.00000001 ，转换成十进制就是 192.168.1，网掩码255.255.255.0的 “0”的个数是右边8位，则这个IP地址的主机号就是11000111，转换成十进制就是199.

作者：知乎用户
链接：https://www.zhihu.com/question/56895036/answer/154192558
来源：知乎
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处.

参考
- [面试官，不要再问我三次握手和四次挥手 | 猿人谷 (yuanrengu.com)](https://yuanrengu.com/2020/77eef79f.html)