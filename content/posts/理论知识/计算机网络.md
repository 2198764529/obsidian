---
mermaid: true
plantuml: true
title: 计算机网络
id: f4cc04863a
datetimeCreate: 2023-10-24 17:01:08
datetimeUpdate: 2024-01-22 10:40:34
---
# 概述

```mindmap 
体系结构
	TCP/IP 四层协议
		应用【应用表示会话】
			报文
			SMTP、FTP、TELNET、\nDNS、TFTP、RPC、HTTP
		运输
			分组, 网关
			TCP、UDP
		网际
			IP数据报, 路由器
			【逻辑寻址】IP、ARP、ICMP、IGMP\n 【路由选择】RIP、OSPF、BGP
		网络接口【数据链路物理】
			子层
				数据链路【帧】
				物理层【比特流】\n【中继器、集线器】
```

```mindmap 
物理层
	特性
		机械
		电气
		功能
		过程
	设备
		中继器
		集线器
	信号
		模拟信号(连续信号)
		数字信号(离散信号)
	调制
		基带调制(编码)
			常用编码方式
				不归零
				归零
				曼彻斯特
				差分曼彻斯特
		载波调制(带通调制)
			常用编码方式
				调幅
				调相
				调位
	信道
		类型
			单工
			半双工
			全双工
		极限容量因素
			信道频率范围
			信噪比
		传输媒体
			有线
				双绞线(无屏蔽,屏蔽)
				同轴电缆
				光缆(光纤)
			无线
				地面微波通信
				卫星通信
		复用技术
			频分复用
			时分复用
			统计时分复用
			波分复用(光的频分复用)
			码分复用
		宽带接入技术
			ADSL(拨号上网)
			FTTx(FTTH,光纤到户)	
数据链路层
	两个基本概念
		数据链路
		帧
	三个基本问题
		封装成帧
		透明传输
		差错检测,CRC(循环冗余校验码)
	两种信道	
		点对点信道
			PPP\nPoint-to-Point Protocol\n点对点协议
		广播信道
			局域网 协议
				LLC\nLogical Link Control\n逻辑链路控制
				MAC\nMedium Access Control\n媒体接入子层
			CSMA/CD\nCarrier Sense Multiple Access With Collision Detection\n载波监听多点接入/碰撞检测)
				多点接入
				载波监听
				碰撞检测
网络层
	设计思路
		简单灵活的,无连接的,尽最大努力交付的数据报服务
	IP\nInternet Protocol\n网际协议
		配套协议
			ARP\nAddress Resolution Protocol\n地址解析协议
			ICMP\nInternet Control Message Protocol\n控制报文协议
			IGMP\nInternet Group Management Protocol\n网际租管理协议
		IP 地址编址
			历史发展阶段, 分类的IP地址>>子网的划分>>构成超网
			构成
				{<网络号>,<主机号>}
			分类
				A 类,{ <网络号(开头为0),8位>,<主机号,24位>}
				B 类,{ <网络号(开头为10),16位>,<主机号,16位>}
				C 类,{ <网络号(开头为110),24位>,<主机号,8位>}
				D 类,开头为1110,多播地址
				E 类,保留为今后使用
		ARP\nAddress Resolution Protocol\n地址解析协议
			功能:用IP地址找到局域网内的对应硬件地址
			关键词:ARP cache, 广播, 局域网
			过程:广播问局域网内主机对应IP的MAC地址,\n匹配主机单播回应
```


# 应用层
应用层协议是为了各应用进程需要不同的通信规则而存在的, 也是要依赖运输层所提供的基本通信服务。
##### 概念
应用层主要包括以下内容
- 域名系统 DNS
- WWW 和 HTTP 协议
- 电子邮件的相关协议，SMTP 协议和 POP3 协议、IMAP 协议

##### 域名系统 DNS
DNS 的作用是将域名转为IP地址，具体的过程是应用进程调用 resolver（解析程序），发送包含待解析的域名的 DNS 请求报文，通过 UDP 进行再包装发送到本地域名服务器，本地域名服务器搜索以后，把对应的 IP 地址放在回答报文返回。

##### 域名
域名是一个空间概念，可比作一个盒子，最大的一个盒就是顶级域名，再里面的盒子叫做二级域名，再里面的盒子叫做三级域名。
如www.baidu.com这个域名，从左到右域名等级依次提高，com就是顶级域名，baidu则是二级域名，www是三级域名。

这些顶级域名和二级域名以及其他等级的域名都是要遵守域名规则
- 必须是英文字母或数字，不区分大小写
- 一个域名长度不超过 63 个字符
- 所有域名加起来长度 255 个字符
# 运输层
### TCP 协议
特点:面向连接(虚连接);点对点;可靠有序,不丢不重;全双工通信;字节流
全双工通信:发送缓存和接收缓存

##### TCP首部
```
0                8                16                24                   31
---------------------------------------------------------------------------
                 源端口            |               目的端口
---------------------------------------------------------------------------
                                  序号(seq)
---------------------------------------------------------------------------
                                  确认号
---------------------------------------------------------------------------
首部长度|保留|[URG,ACK,PSH,RST,SYN,FIN] |		  接收窗口大小
---------------------------------------------------------------------------
              检验和                 |                 紧急指针
---------------------------------------------------------------------------
              选项(长度可变)                         |       填充
---------------------------------------------------------------------------
                              图 TCP的报文段首部


```

说明:
1. TCP首部总长为21B(20B固定,1B占位),第一行总长度都是4B(32位), `|`表示所占区分割线,如源端口所占为[0,16]的区域
2. 序号(seq):在TCP连接的字节流中,报文段中第一个字节的序号
确认号: 下一个要收报文段的序号, 序号为N, 则序号到N-1的数据都已收到
首部长度:表示TCP首部的长度,单位为4B
URG:紧急位,调整报文段优先级
ACK: TCP连接之后,ACk=1,标识为有效报文
PSH: 不需要等发送缓存填满才发
SYN: 标识为同步报文
FIN: 标识为终止报文
接收窗口大小:能够接收窗口的大小
检验和:检验首部+数据,检验要加12B伪首部,第四个字段为6
紧急指针: URG=1才有意义,紧急数据的字节数
选项: 最大报文长度MSS, 窗口扩大,时间戳
##### 三次握手(连接)
```
B -------[SYN=1,seq=x]---------------------->> S
B <<-------[SYN=1, ACK=1,seq=y,ack=x+1]------- S   # S分配缓存和变量
B -------[ACK=1,seq=x+1,ack=y+1]------------>> S   # B分配缓存和变量,可携带数据
```
##### 四次挥手(断开)
```
B -------[FIN=1,seq=x]------------------->> S   # 停止发送,断开连接
B <<--------------[ACK=1,seq=y,ack=x+1]---- S   # 确认关闭
B <<----[FIN=1,ACK=1,seq=z,ack=x+1]-------- S   # 断开连接
B -------[ACK=1,seq=x+1,ack=z+1]--------->> S   # 确认关闭,最长报文段寿命2MSL结束,两者连接彻底关闭
```
##### 可靠传输
- 检验
- 序号
- 确认
- 重传:超时,冗余确认
##### 等待重传
ACK 冗余确认
##### 流量控制
特点:局部出发,控制速率
TCP 会利用滑动窗口机制实现流量控制,根据接收缓存的大小,动态改变发送方的发送窗口
发送窗口 = Min(接收窗口rwnd,拥塞窗口cwnd)
##### 拥塞控制
特点:点对点,全局出发,控制总量
条件:对资源需求 > 可用资源
目的是防止过多的数据注入到网络中
接收窗口:接收方根据接收缓存设置的值,并告诉发送方,反映接收方容量
拥塞窗口:发送方根据估算网络拥塞程度设置的值,反映网络容量

慢开始,拥塞避免:(cwnd)指数增长->sshrend->线性增长->0,接着重复该过程
快重传,快恢复:慢开始的改进,最后一步->(sshrend/2)


### 网络层

##### IP 地址的分类
