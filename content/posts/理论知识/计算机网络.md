---
mermaid: true
plantuml: true
title: 计算机网络
id: f4cc04863a
datetimeCreate: 2023-10-24 17:01:08
datetimeUpdate: 2024-01-25 17:35:38
---
# 概述

```mindmap 
体系结构
	TCP/IP 四层协议
		应用【应用表示会话】
			报文
			SMTP、FTP、TELNET、\nDNS、TFTP、RPC、HTTP
		运输
			【分组】,【网关】
			TCP、UDP
		网际
			IP【数据报】【路由器】
			【逻辑寻址】IP、ARP、ICMP、IGMP\n 【路由选择】RIP、OSPF、BGP
		网络接口【数据链路物理】
			子层
				数据链路【帧】【以太网交换机、网卡】
				物理层【比特流】\n【中继器、集线器、双绞线】
```

```mindmap 
物理层
	特性
		机械
		电气
		功能
		过程
	设备
		中继器
		集线器
	信号
		模拟信号(连续信号)
		数字信号(离散信号)
	调制
		基带调制(编码)
			常用编码方式
				不归零
				归零
				曼彻斯特
				差分曼彻斯特
		载波调制(带通调制)
			常用编码方式
				调幅
				调相
				调位
	信道
		类型
			单工
			半双工
			全双工
		极限容量因素
			信道频率范围
			信噪比
		传输媒体
			有线
				双绞线(无屏蔽,屏蔽)
				同轴电缆
				光缆(光纤)
			无线
				地面微波通信
				卫星通信
		复用技术
			频分复用
			时分复用
			统计时分复用
			波分复用(光的频分复用)
			码分复用
		宽带接入技术
			ADSL(拨号上网)
			FTTx(FTTH,光纤到户)	
数据链路层
	两个基本概念
		数据链路
		帧
	三个基本问题
		封装成帧
		透明传输
		差错检测,CRC(循环冗余校验码)
	两种信道	
		点对点信道
			PPP\nPoint-to-Point Protocol\n点对点协议
		广播信道
			局域网 协议
				LLC\nLogical Link Control\n逻辑链路控制
				MAC\nMedium Access Control\n媒体接入子层
			CSMA/CD\nCarrier Sense Multiple Access With Collision Detection\n载波监听多点接入/碰撞检测)
				多点接入
				载波监听
				碰撞检测
网络层
	设计思路
		简单灵活的,无连接的,尽最大努力交付的数据报服务
	IP\nInternet Protocol\n网际协议
		配套协议
			ARP\nAddress Resolution Protocol\n地址解析协议
			ICMP\nInternet Control Message Protocol\n控制报文协议
			IGMP\nInternet Group Management Protocol\n网际租管理协议
		IP 地址编址
			历史发展阶段, 分类的IP地址>>子网的划分>>构成超网
			构成
				{<网络号>,<主机号>}
			分类
				A 类,{ <网络号(开头为0),8位>,<主机号,24位>}
				B 类,{ <网络号(开头为10),16位>,<主机号,16位>}
				C 类,{ <网络号(开头为110),24位>,<主机号,8位>}
				D 类,开头为1110,多播地址
				E 类,保留为今后使用
		ARP\nAddress Resolution Protocol\n地址解析协议
			功能:用IP地址找到局域网内的对应硬件地址
			关键词:ARP cache, 广播, 局域网
			过程:广播问局域网内主机对应IP的MAC地址,\n匹配主机单播回应
```


# 应用层
应用层协议是为了各应用进程需要不同的通信规则而存在的, 也是要依赖运输层所提供的基本通信服务。
##### 概念
应用层主要包括以下内容
- 域名系统 DNS
- WWW 和 HTTP 协议
- 电子邮件的相关协议，SMTP 协议和 POP3 协议、IMAP 协议

##### 域名系统 DNS
DNS 的作用是将域名转为IP地址，具体的过程是应用进程调用 resolver（解析程序），发送包含待解析的域名的 DNS 请求报文，通过 UDP 进行再包装发送到本地域名服务器，本地域名服务器搜索以后，把对应的 IP 地址放在回答报文返回。

##### 域名
域名是一个空间概念，可比作一个盒子，最大的一个盒就是顶级域名，再里面的盒子叫做二级域名，再里面的盒子叫做三级域名。
如www.baidu.com这个域名，从左到右域名等级依次提高，com就是顶级域名，baidu则是二级域名，www是三级域名。

这些顶级域名和二级域名以及其他等级的域名都是要遵守域名规则
- 必须是英文字母或数字，不区分大小写
- 一个域名长度不超过 63 个字符
- 所有域名加起来长度 255 个字符
# 运输层
### TCP 协议
特点:面向连接(虚连接);点对点;可靠有序,不丢不重;全双工通信;字节流
全双工通信:发送缓存和接收缓存

##### TCP首部
```
0                8                16                24                   31
---------------------------------------------------------------------------
                 源端口            |               目的端口
---------------------------------------------------------------------------
                                  序号(seq)
---------------------------------------------------------------------------
                                  确认号
---------------------------------------------------------------------------
首部长度|保留|[URG,ACK,PSH,RST,SYN,FIN] |		  接收窗口大小
---------------------------------------------------------------------------
              检验和                 |                 紧急指针
---------------------------------------------------------------------------
              选项(长度可变)                         |       填充
---------------------------------------------------------------------------
                              图 TCP的报文段首部


```

说明:
1. TCP首部总长为21B(20B固定,1B占位),第一行总长度都是4B(32位), `|`表示所占区分割线,如源端口所占为[0,16]的区域
2. 序号(seq):在TCP连接的字节流中,报文段中第一个字节的序号
确认号: 下一个要收报文段的序号, 序号为N, 则序号到N-1的数据都已收到
首部长度:表示TCP首部的长度,单位为4B
URG:紧急位,调整报文段优先级
ACK: TCP连接之后,ACk=1,标识为有效报文
PSH: 不需要等发送缓存填满才发
SYN: 标识为同步报文
FIN: 标识为终止报文
接收窗口大小:能够接收窗口的大小
检验和:检验首部+数据,检验要加12B伪首部,第四个字段为6
紧急指针: URG=1才有意义,紧急数据的字节数
选项: 最大报文长度MSS, 窗口扩大,时间戳
##### 三次握手(连接)
```
B -------[SYN=1,seq=x]---------------------->> S
B <<-------[SYN=1, ACK=1,seq=y,ack=x+1]------- S   # S分配缓存和变量
B -------[ACK=1,seq=x+1,ack=y+1]------------>> S   # B分配缓存和变量,可携带数据
```
##### 四次挥手(断开)
```
B -------[FIN=1,seq=x]------------------->> S   # 停止发送,断开连接
B <<--------------[ACK=1,seq=y,ack=x+1]---- S   # 确认关闭
B <<----[FIN=1,ACK=1,seq=z,ack=x+1]-------- S   # 断开连接
B -------[ACK=1,seq=x+1,ack=z+1]--------->> S   # 确认关闭,最长报文段寿命2MSL结束,两者连接彻底关闭
```
##### 可靠传输
- 检验
- 序号
- 确认
- 重传:超时,冗余确认
##### 等待重传
ACK 冗余确认
##### 流量控制
特点:局部出发,控制速率
TCP 会利用滑动窗口机制实现流量控制,根据接收缓存的大小,动态改变发送方的发送窗口
发送窗口 = Min(接收窗口rwnd,拥塞窗口cwnd)
##### 拥塞控制
特点:点对点,全局出发,控制总量
条件:对资源需求 > 可用资源
目的是防止过多的数据注入到网络中
接收窗口:接收方根据接收缓存设置的值,并告诉发送方,反映接收方容量
拥塞窗口:发送方根据估算网络拥塞程度设置的值,反映网络容量

慢开始,拥塞避免:(cwnd)指数增长->sshrend->线性增长->0,接着重复该过程
快重传,快恢复:慢开始的改进,最后一步->(sshrend/2)


### 网络层

##### IP 地址的分类

五类IP地址
0，0.0.0.0 ~ 127.255.255.255 
10，128.0.0.0 ~ 191.255.255.255
110，192.0.0.0 ~ 223.255.255.255
1110，224.0.0.0 ~ 239.255.255.255
1111，240.0.0.0 ~ 255.255.255.255

##### 子网掩码




内网中192.168.1.199的前三组是网络号，后一组是主机号，子网掩码就是255.255.255.0 
首先要说明的是：不是某个IP的网络号和主机号决定子网掩码是什么，而是子网掩码决定了某个IP地址的网络号与主机号是什么，IP地址是要搭配子网掩码使用的。例如上面的子网掩码决定了192.168.1.199的前三段192.168.1是网络号，最后一段199是主机号。
我们再来理解子网掩码的作用，先举个例子，市面上的两个厂家都生产电子秤，每个厂家都坚称他们的秤最准，那你是怎么知道他们的秤到底准不准？很简单，你去找一个 1KG 的国际千克原器，各放到他们的秤上测量，如果秤的测量值是1KG，那这把秤就是准的，子网掩码的作用就相当于这个大家公认的国际千克原器，是我们测量两个IP是否属于同一个网段的一个工具（应该说是让你知道某个IP地址的网络号与主机号分别是什么） 。

如果让你判断一个IP地址：192.168.1.199的网络号和主机号分别是什么？
请问你怎么判断？你凭什么说192.168.1是网络号？199是主机号？有什么根据吗？
但是如果我给你一个IP地址是以下（带子网掩码）形式的：
IP：192.168.1.199 
子网掩码：255.255.255.0 
那么根据大家公认的规则，你就可以得出这个IP的网络号和主机号了，怎么算呢？
子网掩码的长度和IP地址一样也是一串32位的二进制数字，只不过为人类的可读性和记忆性的方便，通常使用十进制数字来表示，例如把上面的IP地址和子网掩码都转换成相应的二进制就是下面这样的：十进制 二进制
IP 地址：192.168.1.199 ‐＞11000000.10101000.00000001.11000111
子网掩码：255.255.255.0 ‐＞11111111.11111111.11111111.00000000
十进制的显示形式是给人看的，二进制的显示形式是给计算机看的。。。
子网掩码的左边是网络位，用二进制数字“1”表示，1的数目等于网络位的长度；右边是主机位，用二进制数字“0”表示，0的数目等于主机位的长度。 
例如上面的子网掩码255.255.255.0的 “1”的个数是左边24位，则对应IP地址左边的位数也是24位;
十进制 二进制
IP 地址：192.168.1.199 ‐＞11000000.10101000.00000001.11000111
子网掩码：255.255.255.0 ‐＞11111111.11111111.11111111.00000000
则这个IP地址的网络号就是11000000.10101000.00000001 ，转换成十进制就是 192.168.1，网掩码255.255.255.0的 “0”的个数是右边8位，则这个IP地址的主机号就是11000111，转换成十进制就是199.

作者：知乎用户
链接：https://www.zhihu.com/question/56895036/answer/154192558
来源：知乎
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。