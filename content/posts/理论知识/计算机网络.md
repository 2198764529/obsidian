---
mermaid: true
title: 计算机网络
id: f4cc04863a
datetimeCreate: 2023-10-24 17:01:08
datetimeUpdate: 2023-11-29 15:50:17
---
# 应用层
应用层协议是为了各应用进程需要不同的通信规则而存在的, 也是要依赖运输层所提供的基本通信服务。
##### 概念
应用层主要包括以下内容
- 域名系统 DNS
- WWW 和 HTTP 协议
- 电子邮件的相关协议，SMTP 协议和 POP3 协议、IMAP 协议

##### 域名系统 DNS
DNS 的作用是将域名转为IP地址，具体的过程是应用进程调用 resolver（解析程序），发送包含待解析的域名的 DNS 请求报文，通过 UDP 进行再包装发送到本地域名服务器，本地域名服务器搜索以后，把对应的 IP 地址放在回答报文返回。

##### 域名
域名是一个空间概念，可比作一个盒子，最大的一个盒就是顶级域名，再里面的盒子叫做二级域名，再里面的盒子叫做三级域名。
如www.baidu.com这个域名，从左到右域名等级依次提高，com就是顶级域名，baidu则是二级域名，www是三级域名。

这些顶级域名和二级域名以及其他等级的域名都是要遵守域名规则
- 必须是英文字母或数字，不区分大小写
- 一个域名长度不超过 63 个字符
- 所有域名加起来长度 255 个字符
# 运输层
### TCP 协议
特点:面向连接(虚连接);点对点;可靠有序,不丢不重;全双工通信;字节流
全双工通信:发送缓存和接收缓存

##### TCP首部
```
0                8                16                24                   31
---------------------------------------------------------------------------
                 源端口            |               目的端口
---------------------------------------------------------------------------
                                  序号(seq)
---------------------------------------------------------------------------
                                  确认号
---------------------------------------------------------------------------
首部长度|保留|[URG,ACK,PSH,RST,SYN,FIN] |		  接收窗口大小
---------------------------------------------------------------------------
              检验和                 |                 紧急指针
---------------------------------------------------------------------------
              选项(长度可变)                         |       填充
---------------------------------------------------------------------------
                              图 TCP的报文段首部

说明:
1.TCP首部总长为21B(20B固定,1B占位),第一行总长度都是4B(32位), `|`表示所占区分割线,如源端口所占为[0,16]的区域
2.
序号(seq):在TCP连接的字节流中,报文段中第一个字节的序号
确认号: 下一个要收报文段的序号, 序号为N, 则序号到N-1的数据都已收到
首部长度:表示TCP首部的长度,单位为4B
URG:紧急位,调整报文段优先级
ACK: TCP连接之后,ACk=1,标识为有效报文
PSH: 不需要等发送缓存填满才发
SYN: 标识为同步报文
FIN: 标识为终止报文
接收窗口大小:能够接收窗口的大小
检验和:检验首部+数据,检验要加12B伪首部,第四个字段为6
紧急指针: URG=1才有意义,紧急数据的字节数
选项: 最大报文长度MSS, 窗口扩大,时间戳
```
##### 三次握手(连接)
```
B -------[SYN=1,seq=x]---------------------->> S
B <<-------[SYN=1, ACK=1,seq=y,ack=x+1]------- S   # S分配缓存和变量
B -------[ACK=1,seq=x+1,ack=y+1]------------>> S   # B分配缓存和变量,可携带数据
```
##### 四次挥手(断开)
```
B -------[FIN=1,seq=x]------------------->> S   # 停止发送,断开连接
B <<--------------[ACK=1,seq=y,ack=x+1]---- S   # 确认关闭
B <<----[FIN=1,ACK=1,seq=z,ack=x+1]-------- S   # 断开连接
B -------[ACK=1,seq=x+1,ack=z+1]--------->> S   # 确认关闭,最长报文段寿命2MSL结束,两者连接彻底关闭
```
##### 可靠传输
- 检验
- 序号
- 确认
- 重传:超时,冗余确认
##### 等待重传
ACK 冗余确认
##### 流量控制
特点:局部出发,控制速率
TCP 会利用滑动窗口机制实现流量控制,根据接收缓存的大小,动态改变发送方的发送窗口
发送窗口 = Min(接收窗口rwnd,拥塞窗口cwnd)
##### 拥塞控制
特点:点对点,全局出发,控制总量
条件:对资源需求 > 可用资源
目的是防止过多的数据注入到网络中
接收窗口:接收方根据接收缓存设置的值,并告诉发送方,反映接收方容量
拥塞窗口:发送方根据估算网络拥塞程度设置的值,反映网络容量

慢开始,拥塞避免:(cwnd)指数增长->sshrend->线性增长->0,接着重复该过程
快重传,快恢复:慢开始的改进,最后一步->(sshrend/2)